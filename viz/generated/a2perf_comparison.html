<!DOCTYPE html>
<html>
<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        .link-line {
            stroke: #404080;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
        }

        .vertical-line {
            stroke: #404080;
            stroke-dasharray: 5, 5;
        }

        .box {
            fill: #F2F2F2;
            stroke: #404080;
            stroke-width: 2;
        }

        .attribute-oval {
            fill: #E6E6FA;
            stroke: #404080;
            stroke-width: 2;
        }

        .text {
            fill: #404080;
            font-size: 14px;
            text-anchor: middle;
        }
    </style>
</head>
<body>
<svg width="1500" height="800"></svg>

<script>
    function wrapText(text, x, y, width, classname) {
        let words = text.split(/\s+/).reverse();
        let word;
        let line = [];
        let lineNumber = 0;
        let lineHeight = 1.1;
        let tspan = svg.append("text")
            .attr("class", classname)
            .attr("x", x)
            .attr("y", y)
            .append("tspan")
            .attr("x", x)
            .attr("dy", "0em");

        while (word = words.pop()) {
            line.push(word);
            tspan.text(line.join(" "));
            if (tspan.node().getComputedTextLength() > width) {
                line.pop();
                tspan.text(line.join(" "));
                line = [word];
                tspan = svg.select("text:last-of-type").append("tspan")
                    .attr("x", x)
                    .attr("dy", lineHeight + "em")
                    .text(word);
                lineNumber++;
            }
        }
    }


    // select the SVG
    var svg = d3.select("svg");

    // Draw the dashed line
    svg.append("line")
        .attr("class", "vertical-line")
        .attr("x1", 575)
        .attr("y1", 110)
        .attr("x2", 575)
        .attr("y2", 660);

    // Categories and their characteristics
    const categories = [
        {
            name: "A2Perf",
            x: 900,  
            y: 400,
            characteristics: ['Real-World Tasks', 'Generalization Metrics', 'Offline Datasets', 'Reliability Metrics', 'System Metrics', 'Training Sample Cost Metrics', 'Task Performance'],
        },
        {
            name: "Existing Benchmarks",
            x: 300,
            y: 400,
            characteristics: ['Toy Tasks', 'Generalization Metrics', 'Offline Datasets', '', '', '', 'Task Performance'],
        },
    ];

    // Randomize order of characteristics for the first category
    const randomizedIndices = Array.from({length: categories[0].characteristics.length}, (_, index) => index);
    randomizedIndices.sort(() => Math.random() - 0.5);

    const randomizedCharacteristics = randomizedIndices.map(index => categories[1].characteristics[index]);

    // Apply the same randomization to the second category
    categories[1].characteristics = randomizedCharacteristics;

    console.log(categories);

    const radius = 200;

    categories.forEach((category, idx) => {

        // Draw links between category and its characteristics
        category.characteristics.forEach((characteristic, i, arr) => {
            // only draw links for non-empty characteristics
            if (characteristic === '') {
                return;
            }

            let angle = (Math.PI * 2 / arr.length) * i;
            let cx = category.x + radius * Math.cos(angle);
            let cy = category.y + radius * Math.sin(angle);

            // Draw line
            svg.append("line")
                .attr("class", "link-line")
                .attr("x1", category.x)
                .attr("y1", category.y)
                .attr("x2", cx)
                .attr("y2", cy);

            // Draw oval
            svg.append("ellipse")
                .attr("class", "attribute-oval")
                .attr("cx", cx)
                .attr("cy", cy)
                .attr("rx", 70)
                .attr("ry", 35);
        });


        let text = svg.append("text")
            .attr("x", category.x)
            .attr("y", category.y + (40 / 2))
            .text(category.name)
            .style("font-size", "25px")
            .style("font-weight", "bold")
            .style("text-anchor", "middle")
            .style("dominant-baseline", "middle");

        let textWidth = text.node().getBBox().width;
        text.remove();

        // make box fit text dynamocally
        // rect_width = 250;
        // rect_height = 40;
        // svg.append("rect")
        //     .attr("class", "box")
        //     .attr("x", category.x - 125)
        //     .attr("y", category.y - 20)
        //     .attr("width", rect_width)
        //     .attr("height", rect_height)
        // ;

        let rect_width = textWidth + 20;  // Add some padding
        rect_height = 40;

        svg.append("rect")
            .attr("class", "box")
            .attr("x", category.x - rect_width / 2)
            .attr("y", category.y - 20)
            .attr("width", rect_width)
            .attr("height", rect_height);


        svg.append("text")
            .attr("x", category.x)
            .attr("y", category.y + (40 / 7))
            .text(category.name)
            .style("font-size", "25px")
            .style("font-weight", "bold")
            .style("text-anchor", "middle")
            .style("dominant-baseline", "middle");

        // Add characteristic labels after box and link lines have been created
        category.characteristics.forEach((characteristic, i, arr) => {

            let newRadius = Math.max(radius, rect_width / 2 + 70);  // Ensure the radius is always greater than half the width of the rectangle plus the width of an oval
            let angle = (Math.PI * 2 / arr.length) * i;
            let cx = category.x + newRadius * Math.cos(angle);
            let cy = category.y + newRadius * Math.sin(angle);


            wrapText(characteristic, cx, cy, 100, "text");

        });
    });
</script>
</body>
</html>
